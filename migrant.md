# BlindPoem æŠ€æœ¯æ¶æ„ä¸å¹³å°è¿ç§»æŒ‡å—

æˆ‘æ˜¯ä¸€ä¸ªç¼–ç¨‹å°ç™½ï¼Œæˆ‘å·²ç»æœ‰ä¸€ä¸ªç½‘ç«™ï¼Œæ¶æ„å’Œå…·ä½“ç»†èŠ‚è¯·å‚è€ƒmigrant.mdæ–‡ä»¶ã€‚ä½ å¸®æˆ‘ç”Ÿæˆä¸€ä¸ªå°†è¿™ä¸ªç½‘ç«™è¿ç§»åˆ°å°ç¨‹åºçš„é¡¹ç›®æµç¨‹ï¼Œè¦åŒ…å«æ¯ä¸€æ­¥çš„è®¡åˆ’å’ŒéªŒæ”¶æ–¹æ³•ï¼Œæ¯ä¸€æ­¥å°½é‡å°‘åšçš„äº‹æƒ…ï¼Œå¯ä»¥å¤šä¸€äº›æ­¥éª¤ã€‚æˆ‘é¢„æƒ³åˆ°çš„è¿ç§»éš¾ç‚¹åœ¨AIçš„è°ƒç”¨å’Œæ•°æ®åº“çš„APIä¸Šï¼Œè¿™ä¸¤ç‚¹è¯·å¸®æˆ‘è¯¦æƒ…ä»‹ç»å¦‚ä½•è¿ç§»ã€‚

> æœ¬æ–‡æ¡£è¯¦ç»†è§£æ BlindPoemï¼ˆç›²ç›’è¯—ï¼‰é¡¹ç›®çš„æŠ€æœ¯æ¶æ„ï¼Œä¸ºè¿ç§»åˆ°ç§»åŠ¨ç«¯ã€å°ç¨‹åºæˆ–æ¡Œé¢åº”ç”¨æä¾›å®Œæ•´çš„æŠ€æœ¯å‚è€ƒã€‚

## ğŸ“‘ ç›®å½•

- [ä¸€ã€æ•´ä½“æ¶æ„æ¦‚è§ˆ](#ä¸€æ•´ä½“æ¶æ„æ¦‚è§ˆ)
- [äºŒã€æ ¸å¿ƒæŠ€æœ¯æ ˆ](#äºŒæ ¸å¿ƒæŠ€æœ¯æ ˆ)
- [ä¸‰ã€æ ¸å¿ƒåŠŸèƒ½æ¨¡å—åˆ†æ](#ä¸‰æ ¸å¿ƒåŠŸèƒ½æ¨¡å—åˆ†æ)
- [å››ã€çŠ¶æ€ç®¡ç†æ¶æ„](#å››çŠ¶æ€ç®¡ç†æ¶æ„)
- [äº”ã€æ•°æ®æµè®¾è®¡](#äº”æ•°æ®æµè®¾è®¡)
- [å…­ã€å…³é”®æŠ€æœ¯ç»†èŠ‚](#å…­å…³é”®æŠ€æœ¯ç»†èŠ‚)
- [ä¸ƒã€å¹³å°è¿ç§»æŒ‡å—](#ä¸ƒå¹³å°è¿ç§»æŒ‡å—)
- [å…«ã€æ ¸å¿ƒä¾èµ–](#å…«æ ¸å¿ƒä¾èµ–)
- [ä¹ã€æ€»ç»“](#ä¹æ€»ç»“)

---

## ä¸€ã€æ•´ä½“æ¶æ„æ¦‚è§ˆ

### æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å‰ç«¯å±•ç¤ºå±‚                          â”‚
â”‚  React 18 + TypeScript + Vite + Tailwind CSS           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   AI æœåŠ¡å±‚    â”‚    â”‚   æ•°æ®æŒä¹…å±‚      â”‚
â”‚  Gemini API    â”‚    â”‚   Supabase       â”‚
â”‚  (è¯—å¥ç”Ÿæˆ)    â”‚    â”‚   (PostgreSQL)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### é¡¹ç›®ç‰¹ç‚¹

- **æ— æœåŠ¡å™¨æ¶æ„**: å®Œå…¨ä¾èµ–äº‘æœåŠ¡ï¼ˆGemini AI + Supabaseï¼‰ï¼Œæ— éœ€è‡ªå»ºåç«¯
- **çº¯å‰ç«¯å®ç°**: æ‰€æœ‰ä¸šåŠ¡é€»è¾‘åœ¨å®¢æˆ·ç«¯å®Œæˆ
- **ç±»å‹å®‰å…¨**: TypeScript å…¨è¦†ç›–
- **æ€§èƒ½ä¼˜åŒ–**: Canvas æ¸²æŸ“ + GPU åŠ é€ŸåŠ¨ç”»

---

## äºŒã€æ ¸å¿ƒæŠ€æœ¯æ ˆ

### 1. å‰ç«¯æ¡†æ¶

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| React | 18.x | UI æ¡†æ¶ï¼ˆå‡½æ•°ç»„ä»¶ + Hooksï¼‰ |
| TypeScript | 5.x | ç±»å‹å®‰å…¨ |
| Vite | 5.x | å¼€å‘æœåŠ¡å™¨å’Œæ„å»ºå·¥å…· |
| Tailwind CSS | 4.x | å®ç”¨ä¼˜å…ˆçš„æ ·å¼ç³»ç»Ÿ |

### 2. å¤–éƒ¨æœåŠ¡

| æœåŠ¡ | ç”¨é€” | è°ƒç”¨æ–¹å¼ |
|------|------|----------|
| **Gemini AI API** | è¯—å¥ç”Ÿæˆ | REST APIï¼ˆæ— éœ€ SDKï¼‰ |
| **Supabase** | PostgreSQL æ•°æ®åº“ | JS SDKï¼ˆ`@supabase/supabase-js`ï¼‰ |

### 3. å¼€å‘å·¥å…·

- **ESLint**: ä»£ç è§„èŒƒæ£€æŸ¥
- **PostCSS**: CSS å¤„ç†
- **ç¯å¢ƒå˜é‡**: `.env.local` ç®¡ç†å¯†é’¥

---

## ä¸‰ã€æ ¸å¿ƒåŠŸèƒ½æ¨¡å—åˆ†æ

### æ¨¡å— 1: Emoji äº¤äº’ç³»ç»Ÿ

**æ–‡ä»¶ä½ç½®**: `src/App.tsx` (ç¬¬ 7-42 è¡Œ)

#### æ•°æ®ç»“æ„

```typescript
interface EmojiMood {
  emoji: string;    // Emoji å­—ç¬¦ï¼ˆå¦‚ï¼šğŸ˜Šï¼‰
  mood: string;     // ä¸­æ–‡å¿ƒæƒ…åï¼ˆå¦‚ï¼šå¿«ä¹ï¼‰
  keyword: string;  // è‹±æ–‡å…³é”®è¯ï¼ˆå¦‚ï¼šhappyï¼‰
}

const EMOJI_MOODS = [
  { emoji: 'ğŸ˜Š', mood: 'å¿«ä¹', keyword: 'happy' },
  { emoji: 'ğŸ˜¢', mood: 'æ‚²ä¼¤', keyword: 'sad' },
  // ... å…± 27 ä¸ªæƒ…ç»ª
];
```

#### æ ¸å¿ƒç‰¹æ€§

1. **éšæœºä½ç½®åˆ†å¸ƒ** (ç¬¬ 519-547 è¡Œ)
   - 27 ä¸ª Emoji åˆ†å¸ƒåœ¨å±å¹•ä¸åŒä½ç½®
   - ä½¿ç”¨ç™¾åˆ†æ¯”å®šä½ï¼Œå“åº”å¼é€‚é…

2. **ç‰©ç†å¼•æ“** (ç¬¬ 504-628 è¡Œ)
   ```typescript
   interface EmojiPhysics {
     x: number;          // åƒç´ ä½ç½®
     y: number;
     vx: number;         // é€Ÿåº¦ï¼ˆ0.1-0.3 px/frameï¼‰
     vy: number;
     rotation: number;   // æ—‹è½¬è§’åº¦
     rotationSpeed: number;  // æ—‹è½¬é€Ÿåº¦
   }
   ```
   - è¶…çº§ç¼“æ…¢ç§»åŠ¨ï¼ˆ0.1-0.3 px/frameï¼‰
   - å±å¹•è¾¹ç•Œç¢°æ’åå¼¹ï¼ˆé˜»å°¼ç³»æ•° 0.92ï¼‰
   - ç¼“æ…¢æ—‹è½¬

3. **å¤šå½©è¾‰å…‰åŠ¨ç”»** (ç¬¬ 474-501 è¡Œ)
   - æ¯ä¸ª Emoji éšæœºåˆ†é…é¢œè‰²ï¼ˆ8 ç§ï¼‰
   - å‘¼å¸å¼è¾‰å…‰ï¼ˆ15-33 ç§’å‘¨æœŸï¼‰
   - è¾‰å…‰å¤§å°åŠ¨æ€å˜åŒ–ï¼ˆ10-32pxï¼‰
   - é¼ æ ‡æ‚¬åœå¢å¼ºæ•ˆæœ

#### è¿ç§»å»ºè®®

| å¹³å° | é€‚é…æ–¹æ¡ˆ |
|------|----------|
| **React Native** | ä½¿ç”¨ `react-native-reanimated` æ›¿ä»£ç‰©ç†å¼•æ“ï¼Œç®€åŒ–ç¢°æ’æ£€æµ‹ |
| **å¾®ä¿¡å°ç¨‹åº** | ç®€åŒ–ä¸º CSS åŠ¨ç”»ï¼Œå–æ¶ˆç‰©ç†å¼•æ“ï¼ˆæ€§èƒ½é™åˆ¶ï¼‰ |
| **Electron** | ä¿æŒå®Œæ•´å®ç°ï¼Œæ€§èƒ½æ›´ä¼˜ |

---

### æ¨¡å— 2: AI è¯—å¥ç”Ÿæˆç³»ç»Ÿ

**æ–‡ä»¶ä½ç½®**: `src/lib/geminiClient.ts`

#### æ ¸å¿ƒæµç¨‹

```
ç”¨æˆ·ç‚¹å‡» Emoji
  â†“
æå– keywordï¼ˆå¦‚ï¼šhappyï¼‰+ moodï¼ˆå¦‚ï¼šå¿«ä¹ï¼‰
  â†“
åŠ¨æ€ç”Ÿæˆ Promptï¼ˆ6 ç§æ¨¡æ¿éšæœºé€‰æ‹©ï¼‰
  â†“
è°ƒç”¨ Gemini APIï¼ˆREST æ¥å£ï¼‰
  â†“
è§£æ JSON å“åº” â†’ { content, poem_title, author }
  â†“
å±•ç¤ºè¯—å¥ + å¼‚æ­¥ä¿å­˜åˆ°æ•°æ®åº“
```

#### API è°ƒç”¨å®ç°

```typescript
// REST API è°ƒç”¨ï¼ˆæ— éœ€ SDKï¼‰
const response = await fetch(
  'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent',
  {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'x-goog-api-key': API_KEY,
    },
    body: JSON.stringify({
      contents: [{
        parts: [{ text: prompt }]
      }],
      generationConfig: {
        temperature: 1.1,  // é«˜éšæœºæ€§ï¼Œå¢åŠ å¤šæ ·æ€§
        topK: 40,
        topP: 0.95,
        maxOutputTokens: 512,
      }
    })
  }
);
```

#### 6 ç§ Prompt æ¨¡æ¿

| æ¨¡æ¿ç±»å‹ | å€¾å‘ | æ¸©åº¦å‚æ•° |
|---------|------|---------|
| ä¸­æ–‡ç‰ˆ | ä¸­å›½å¤å…¸è¯—è¯ã€ç°ä»£è¯— | 1.1 |
| è‹±æ–‡ç‰ˆ | è‹±æ–‡ç»å…¸è¯—æ­Œ | 1.1 |
| ç°ä»£è¯—ç‰ˆ | 20 ä¸–çºªè‡³ä»Šçš„ç°ä»£è¯— | 1.1 |
| å¤å…¸è¯—è¯ç‰ˆ | å”è¯—ã€å®‹è¯ã€å…ƒæ›² | 1.1 |
| æ··åˆç‰ˆ | å®Œå…¨éšæœºï¼Œå¯èƒ½æ— å…³å¿ƒæƒ… | 1.1 |
| ç½‘ç»œæ–‡å­¦ç‰ˆ | ç½‘ç»œé‡‘å¥ã€æ­Œè¯ã€ç”µå½±å°è¯ | 1.1 |

**éšæœºåŒ–ç­–ç•¥**:
- æ¯æ¬¡è¯·æ±‚éšæœºé€‰æ‹©ä¸€ç§ Prompt æ¨¡æ¿
- æ·»åŠ éšæœºç§å­ï¼ˆ`Date.now()`ï¼‰å’Œéšæœºæç¤ºè¯
- ç¡®ä¿ç›¸åŒæƒ…ç»ªä¹Ÿèƒ½ç”Ÿæˆä¸åŒè¯—å¥

#### å“åº”è§£æ

```typescript
// 1. è·å–æ–‡æœ¬å†…å®¹
let text = data.candidates[0].content.parts[0].text;

// 2. æ¸…ç† markdown æ ‡è®°
text = text.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim();

// 3. æå– JSON
const jsonMatch = text.match(/\{[\s\S]*\}/);
const poemData: PoemResponse = JSON.parse(jsonMatch[0]);

// 4. éªŒè¯æ•°æ®å®Œæ•´æ€§
if (!poemData.content || !poemData.poem_title || !poemData.author) {
  throw new Error('AI è¿”å›æ•°æ®ä¸å®Œæ•´');
}
```

#### è¿ç§»å»ºè®®

| å¹³å° | é€‚é…æ–¹æ¡ˆ |
|------|----------|
| **React Native** | å®Œå…¨å…¼å®¹ï¼Œä¿æŒ `fetch` è°ƒç”¨ |
| **å¾®ä¿¡å°ç¨‹åº** | ä½¿ç”¨ `wx.request()`ï¼Œéœ€é…ç½®æœåŠ¡å™¨åŸŸåç™½åå• |
| **Electron** | å»ºè®®ä½¿ç”¨ IPC é€šä¿¡ï¼Œåç«¯ Node.js ç®¡ç† API Keyï¼ˆå®‰å…¨æ€§ï¼‰ |

---

### æ¨¡å— 3: æ•°æ®æŒä¹…åŒ–ï¼ˆSupabaseï¼‰

**æ–‡ä»¶ä½ç½®**: 
- `src/lib/supabaseClient.ts` - å®¢æˆ·ç«¯é…ç½®
- `src/lib/poemService.ts` - ä¸šåŠ¡é€»è¾‘

#### æ•°æ®åº“æ¶æ„

```sql
CREATE TABLE poems (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  content TEXT NOT NULL UNIQUE,  -- è¯—å¥å†…å®¹ï¼ˆå”¯ä¸€çº¦æŸï¼‰
  poem_title TEXT,                -- è¯—å
  author TEXT,                    -- ä½œè€…
  mood TEXT,                      -- å¿ƒæƒ…å…³é”®è¯ï¼ˆhappy, sad...ï¼‰
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- ç´¢å¼•ä¼˜åŒ–
CREATE INDEX idx_poems_mood ON poems(mood);
CREATE INDEX idx_poems_created_at ON poems(created_at DESC);
```

#### æ ¸å¿ƒæ“ä½œ

##### 1. å†™å…¥ï¼ˆå»é‡ï¼‰

```typescript
export async function savePoemToDatabase(
  content: string,
  poem_title: string,
  author: string,
  mood: string
): Promise<boolean> {
  // 1. æ£€æŸ¥å”¯ä¸€æ€§
  const exists = await isPoemExists(content);
  if (exists) {
    console.log('âš ï¸ è¯—å¥å·²å­˜åœ¨ï¼Œè·³è¿‡å†™å…¥');
    return false;
  }

  // 2. å†™å…¥æ•°æ®åº“
  const { error } = await supabase.from('poems').insert({
    content, poem_title, author, mood
  });

  return !error;
}
```

##### 2. è¯»å–ï¼ˆå®¹é”™æœºåˆ¶ï¼‰

```typescript
export async function getRandomPoemFromDatabase(): Promise<Poem | null> {
  // 1. éšæœºè·å– 10 æ¡
  const { data } = await supabase
    .from('poems')
    .select('*')
    .limit(10);

  // 2. å®¢æˆ·ç«¯éšæœºé€‰æ‹© 1 æ¡
  const randomIndex = Math.floor(Math.random() * data.length);
  return data[randomIndex];
}
```

#### å®¹é”™æµç¨‹

```
AI è°ƒç”¨å¤±è´¥
  â†“
catch (error)
  â†“
è°ƒç”¨ getRandomPoemFromDatabase()
  â†“
[æˆåŠŸ] â†’ å±•ç¤ºå¤‡ç”¨è¯—å¥
[å¤±è´¥] â†’ alert('è·å–è¯—å¥å¤±è´¥')
```

#### è¿ç§»å»ºè®®

| å¹³å° | é€‚é…æ–¹æ¡ˆ |
|------|----------|
| **React Native** | Supabase JS SDK å®Œå…¨å…¼å®¹ |
| **å¾®ä¿¡å°ç¨‹åº** | ä½¿ç”¨ Supabase REST API æˆ–äº‘å¼€å‘æ•°æ®åº“ |
| **Electron** | å®Œå…¨å…¼å®¹ï¼Œå¯ç»§ç»­ä½¿ç”¨ JS SDK |

---

### æ¨¡å— 4: è§†è§‰ç³»ç»Ÿ

#### 4.1 å…¥åœºåŠ¨ç”»åºåˆ—

**æ–‡ä»¶ä½ç½®**: `src/App.tsx` (ç¬¬ 45-189 è¡Œ)

| æ—¶é—´ | åŠ¨ç”»æ•ˆæœ |
|------|----------|
| **0-11 ç§’** | 8 è¡Œè¯—å¥é€è¡Œæ·¡å…¥ï¼ˆåŸºäºå­—ç¬¦æ•°åˆ†é…æ—¶é•¿ï¼‰ |
| **11-13 ç§’** | åœç•™ 2 ç§’ï¼Œè®©ç”¨æˆ·æ¬£èµå®Œæ•´è¯—å¥ |
| **13-15.9 ç§’** | æ‰€æœ‰è¯—å¥é€è¡Œæ·¡å‡ºï¼ˆæ¯è¡Œå»¶è¿Ÿ 0.2 ç§’ï¼‰ |
| **15.9 ç§’** | ç¬¬ 1 å¥å’Œæœ€å 1 å¥ä»åº•éƒ¨æ·¡å…¥ï¼ˆèƒŒæ™¯ï¼‰ |
| **16 ç§’** | 27 ä¸ª Emoji å¼€å§‹æ·¡å…¥ï¼ˆ5 ç§’æ¸å…¥ï¼‰ |
| **21 ç§’** | æç¤ºè¯æ·¡å…¥ï¼š"åœ¨æ¯ä¸€ä¸ªç¬é—´çš„æƒ…ç»ªé‡Œ..." |

**å…³é”®ä»£ç **:

```typescript
// æ ¹æ®å­—ç¬¦æ•°è®¡ç®—æ¯å¥çš„æ·¡å…¥æ—¶é•¿ï¼ˆæ¯ç§’ 2 ä¸ªå­—ç¬¦ï¼‰
const getLineFadeInDuration = (index: number): number => {
  return charCounts[index] / 2;
};

// è®¡ç®—æ¯å¥çš„å¼€å§‹æ—¶é—´ï¼ˆæ€»æ—¶é•¿ 8 ç§’ + æ¯å¥ 0.5 ç§’ delayï¼‰
const getLineStartTime = (index: number): number => {
  let startTime = 0;
  for (let i = 0; i < index; i++) {
    startTime += (charCounts[i] / totalChars) * totalDuration;
  }
  return startTime + index * 0.5;
};
```

#### 4.2 Canvas ç²’å­ç³»ç»Ÿ

**æ–‡ä»¶ä½ç½®**: `src/App.tsx` (ç¬¬ 192-471 è¡Œ)

##### ç²’å­é…ç½®

| å±‚çº§ | æ•°é‡ | å¤§å°ï¼ˆpxï¼‰ | é€æ˜åº¦ | é¢œè‰² |
|------|------|-----------|--------|------|
| **å‰æ™¯** | 40 | 1.5-3.5 | 0.3-1.0 | çº¯ç™½ï¼ˆ255,255,255ï¼‰ |
| **ä¸­æ™¯** | 40 | 1.0-2.0 | 0.1-0.6 | æ·¡è“ç™½ï¼ˆ220,230,255ï¼‰ |
| **èƒŒæ™¯** | 40 | 0.5-1.2 | 0.05-0.35 | åè“ï¼ˆ180,200,255ï¼‰ |

**æ€»è®¡**: 120 ä¸ªç²’å­

##### åŠ¨ç”»æ•ˆæœ

1. **é—ªçƒåŠ¨ç”»**
   - é—ªçƒæ—¶é•¿: 0.5-2 ç§’ï¼ˆå¿«é€Ÿä»æœ€ä½â†’æœ€é«˜â†’æœ€ä½ï¼‰
   - ä¿æŒæ—¶é•¿: 20-60 ç§’ï¼ˆä¿æŒåœ¨æœ€ä½äº®åº¦ï¼‰
   - ä½¿ç”¨æ­£å¼¦æ³¢å®ç°å¹³æ»‘è¿‡æ¸¡

2. **æµ®åŠ¨åŠ¨ç”»**
   - æµ®åŠ¨å‘¨æœŸ: 60-160 ç§’ï¼ˆè¶…çº§ç¼“æ…¢ï¼‰
   - æµ®åŠ¨åŠå¾„: 5-20px
   - åœ†å‘¨è¿åŠ¨è½¨è¿¹

3. **æµæ˜Ÿæ•ˆæœ** (ç¬¬ 631-705 è¡Œ)
   - æ¯ 30 ç§’è‡ªåŠ¨è§¦å‘ä¸€æ¬¡
   - è¯—å¥æ·¡å‡ºæ—¶ 50% æ¦‚ç‡è§¦å‘
   - 6 ç§éšæœºæ–¹å‘ï¼ˆå³ä¸‹ã€å·¦ä¸‹ã€å³ä¸Šã€å·¦ä¸Šã€æ­£ä¸‹ã€æ­£å³ï¼‰
   - æµæ˜ŸæŒç»­ 2 ç§’
   - å¸¦æ‹–å°¾å’Œå…‰æ™•æ•ˆæœ
   - æµæ˜Ÿæ¶ˆå¤±åç²’å­åœ¨æ–°ä½ç½®é‡ç”Ÿ

##### æ€§èƒ½ä¼˜åŒ–

```typescript
// 1. useMemo ç¼“å­˜ç²’å­æ•°æ®ï¼ˆåªè®¡ç®—ä¸€æ¬¡ï¼‰
const particleSequences = useMemo(() => {
  return { frontLayer, midLayer, backLayer };
}, []); // ç©ºä¾èµ–æ•°ç»„

// 2. Canvas ä½¿ç”¨ requestAnimationFrame
const render = () => {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  allParticles.forEach(particle => {
    // ç»˜åˆ¶é€»è¾‘...
  });
  particleAnimationRef.current = requestAnimationFrame(render);
};

// 3. GPU åŠ é€Ÿ
canvas.style.willChange = 'transform, opacity';
canvas.style.backfaceVisibility = 'hidden';
```

#### 4.3 èƒŒæ™¯æ¸å˜

**æ–‡ä»¶ä½ç½®**: `src/App.tsx` (ç¬¬ 993-1002 è¡Œ)

```css
/* æ·±å¤œè“ â†’ é»æ˜ç´« */
background: linear-gradient(180deg, #0a0e27 0%, #1a1a3e 100%);

/* 40 ç§’å¾ªç¯åŠ¨ç”» */
animation: dawnGradient 40s ease-in-out infinite;
```

#### 4.4 å…‰èŠ’å±‚

**æ–‡ä»¶ä½ç½®**: `src/App.tsx` (ç¬¬ 1005-1054 è¡Œ)

| å±‚çº§ | å°ºå¯¸ | æ¨¡ç³Šåº¦ | åŠ¨ç”»å‘¨æœŸ |
|------|------|--------|---------|
| æ ¸å¿ƒå…‰èŠ’ | 150vw Ã— 150vh | 60px | 12 ç§’ |
| ç¬¬äºŒå±‚ | 180vw Ã— 180vh | 80px | 18 ç§’ |
| ç¬¬ä¸‰å±‚ | 200vw Ã— 200vh | 100px | 25 ç§’ |

#### è¿ç§»å»ºè®®

| å¹³å° | è§†è§‰ç³»ç»Ÿé€‚é… |
|------|-------------|
| **React Native** | Canvas â†’ `react-native-skia`ï¼Œç²’å­æ•°å‡å°‘åˆ° 50 ä¸ª |
| **å¾®ä¿¡å°ç¨‹åº** | Canvas 2D API å…¼å®¹ï¼Œä½†éœ€ä¼˜åŒ–æ€§èƒ½ï¼ˆç²’å­å‡å°‘åˆ° 30 ä¸ªï¼‰ |
| **Electron** | å®Œå…¨ä¿ç•™ï¼Œç”šè‡³å¯å¢åŠ åˆ° 200 ä¸ªç²’å­ |

---

## å››ã€çŠ¶æ€ç®¡ç†æ¶æ„

### æ ¸å¿ƒçŠ¶æ€

```typescript
// 1. å…¥åœºåŠ¨ç”»çŠ¶æ€
const [welcomePhase, setWelcomePhase] = useState<'lines' | 'sliding' | 'complete'>('lines');
const [showWelcome] = useState(true);
const [emojisVisible, setEmojisVisible] = useState(false);
const [showPrompt, setShowPrompt] = useState(false);
const [showPromptAnimation, setShowPromptAnimation] = useState(false);

// 2. AI äº¤äº’çŠ¶æ€
const [isLoading, setIsLoading] = useState(false);
const [poemData, setPoemData] = useState<{
  content: string;
  poem_title: string;
  author: string;
} | null>(null);

// 3. èµèµåŠŸèƒ½çŠ¶æ€
const [showLoveButton, setShowLoveButton] = useState(false);
const [isLoved, setIsLoved] = useState(false);
const [showQRCode, setShowQRCode] = useState(false);

// 4. åŠ¨ç”»çŠ¶æ€
const [isPoemFadingOut, setIsPoemFadingOut] = useState(false);
const [isQRFadingOut, setIsQRFadingOut] = useState(false);

// 5. ç‰©ç†å¼•æ“çŠ¶æ€
const [emojiPhysics, setEmojiPhysics] = useState<EmojiPhysics[]>([]);
const [physicsEnabled, setPhysicsEnabled] = useState(false);

// 6. æµæ˜Ÿç³»ç»ŸçŠ¶æ€
const [meteorParticles, setMeteorParticles] = useState<Map<string, MeteorInfo>>(new Map());
const [particlePositionOverrides, setParticlePositionOverrides] = useState<Map<string, Position>>(new Map());
```

### çŠ¶æ€ç®¡ç†æ–¹å¼

- **å®Œå…¨ä½¿ç”¨ React å†…ç½® Hooks**
  - `useState`: çŠ¶æ€ç®¡ç†
  - `useEffect`: å‰¯ä½œç”¨ç®¡ç†ï¼ˆå®šæ—¶å™¨ã€äº‹ä»¶ç›‘å¬ï¼‰
  - `useMemo`: æ€§èƒ½ä¼˜åŒ–ï¼ˆç¼“å­˜ç²’å­æ•°æ®ï¼‰
  - `useCallback`: å‡½æ•°ç¼“å­˜ï¼ˆæµæ˜Ÿè§¦å‘ï¼‰
  - `useRef`: Canvas å¼•ç”¨ã€åŠ¨ç”»å¸§ ID

- **æ— å¤–éƒ¨çŠ¶æ€åº“**ï¼ˆå¦‚ Reduxã€Zustandï¼‰
- **é€‚åˆä¸­å°å‹åº”ç”¨**

### è¿ç§»å»ºè®®

| å¹³å° | çŠ¶æ€ç®¡ç†æ–¹æ¡ˆ |
|------|-------------|
| **React Native** | ä¿æŒç›¸åŒçš„ Hooks æ–¹æ¡ˆ |
| **å¾®ä¿¡å°ç¨‹åº** | ä½¿ç”¨ `this.setData()` + `Page` ç”Ÿå‘½å‘¨æœŸ |
| **Electron** | ä¿æŒç›¸åŒï¼Œå¯è€ƒè™‘å¢åŠ  Electron Store |

---

## äº”ã€æ•°æ®æµè®¾è®¡

### ç”¨æˆ·äº¤äº’å®Œæ•´æµç¨‹

```
1. ç”¨æˆ·ç‚¹å‡» Emoji
   â†“
2. handleEmojiClick(keyword, mood)
   â†“
3. [å¦‚æœæœ‰æ—§è¯—å¥]
   â†’ æ·¡å‡ºäºŒç»´ç ï¼ˆ0.5 ç§’ï¼‰
   â†’ æ·¡å‡ºè¯—å¥æ¡†ï¼ˆ0.8 ç§’ï¼‰
   â†’ 50% æ¦‚ç‡è§¦å‘æµæ˜Ÿ
   â†“
4. setIsLoading(true) + éšè—æç¤ºè¯
   â†“
5. è°ƒç”¨ generatePoem(keyword, mood)
   â†“
6. [AI æˆåŠŸ]
   â†’ setPoemData()
   â†’ savePoemToDatabase()ï¼ˆå¼‚æ­¥ï¼Œä¸é˜»å¡ UIï¼‰
   â†“
   [AI å¤±è´¥]
   â†’ catch (error)
   â†’ getRandomPoemFromDatabase()ï¼ˆå®¹é”™ï¼‰
   â†“
7. setIsLoading(false)
   â†“
8. [æ ¹æ®è¯—å¥é•¿åº¦è®¡ç®—é˜…è¯»æ—¶é•¿]
   â†’ ä¸­æ–‡ï¼šæ¯ç§’ 3 ä¸ªå­—ç¬¦
   â†’ è‹±æ–‡ï¼šæ¯ç§’ 8 ä¸ªå­—ç¬¦
   â†’ ä¸Šé™ 15 ç§’
   â†“
9. setTimeout() â†’ setShowLoveButton(true)
   â†“
10. [ç”¨æˆ·ç‚¹å‡»çˆ±å¿ƒ]
    â†’ setIsLoved(true)
    â†’ setShowQRCode(true)
    â†“
11. [30 ç§’å] â†’ setShowQRCode(false)ï¼ˆè‡ªåŠ¨éšè—ï¼‰
```

### å®¹é”™æœºåˆ¶

```
AI è°ƒç”¨å¤±è´¥
  â†“
catch (error)
  â†“
console.error('âŒ AI è°ƒç”¨å¤±è´¥')
  â†“
è°ƒç”¨ getRandomPoemFromDatabase()
  â†“
[æ•°æ®åº“æœ‰æ•°æ®]
  â†’ setPoemData(fallbackPoem)
  â†’ å±•ç¤ºå¤‡ç”¨è¯—å¥
  â†“
[æ•°æ®åº“ä¸ºç©º]
  â†’ alert('è·å–è¯—å¥å¤±è´¥ï¼Œä¸”æ•°æ®åº“ä¸­æš‚æ— å¤‡ç”¨è¯—å¥')
```

### å¼‚æ­¥æ“ä½œè®¾è®¡

```typescript
// âœ… æ­£ç¡®ï¼šAI æˆåŠŸåå¼‚æ­¥ä¿å­˜ï¼Œä¸é˜»å¡ UI
const poem = await generatePoem(keyword, mood);
setPoemData(poem);  // ç«‹å³å±•ç¤º

// ä¸ä½¿ç”¨ awaitï¼Œä¸é˜»å¡ UI
savePoemToDatabase(poem.content, poem.poem_title, poem.author, keyword);
```

---

## å…­ã€å…³é”®æŠ€æœ¯ç»†èŠ‚

### 1. æ€§èƒ½ä¼˜åŒ–

#### useMemo ç¼“å­˜ç²’å­æ•°æ®

```typescript
// âŒ é”™è¯¯ï¼šæ¯æ¬¡æ¸²æŸ“éƒ½é‡æ–°ç”Ÿæˆç²’å­ï¼ˆå¯¼è‡´é—ªçƒï¼‰
const particles = Array.from({ length: 120 }, () => ({
  x: Math.random(),
  y: Math.random(),
  // ...
}));

// âœ… æ­£ç¡®ï¼šä½¿ç”¨ useMemo ç¼“å­˜ï¼ˆåªè®¡ç®—ä¸€æ¬¡ï¼‰
const particleSequences = useMemo(() => {
  const frontLayer = generateParticles(40, 'front', 0, 3);
  const midLayer = generateParticles(40, 'mid', 1, 4);
  const backLayer = generateParticles(40, 'back', 2, 5);
  return { frontLayer, midLayer, backLayer };
}, []); // ç©ºä¾èµ–æ•°ç»„ - åªè®¡ç®—ä¸€æ¬¡
```

#### Canvas æ¸²æŸ“ä¼˜åŒ–

```typescript
// 1. ä½¿ç”¨ requestAnimationFrame
const render = () => {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  // ç»˜åˆ¶é€»è¾‘...
  particleAnimationRef.current = requestAnimationFrame(render);
};

// 2. GPU åŠ é€Ÿ
canvas.style.willChange = 'transform, opacity';
canvas.style.backfaceVisibility = 'hidden';

// 3. æ¸…ç†åŠ¨ç”»å¸§
return () => {
  if (particleAnimationRef.current) {
    cancelAnimationFrame(particleAnimationRef.current);
  }
};
```

#### CSS æ€§èƒ½ä¼˜åŒ–

```css
/* âœ… ä¼˜å…ˆä½¿ç”¨ transform å’Œ opacityï¼ˆGPU åŠ é€Ÿï¼‰ */
.emoji-btn {
  transform: translate(-50%, -50%) rotate(0deg);
  opacity: 1;
  will-change: transform, opacity;
}

/* âŒ é¿å…ä½¿ç”¨ widthã€heightã€margin åŠ¨ç”»ï¼ˆä¼šè§¦å‘é‡æ’ï¼‰ */
```

---

### 2. åŠ¨ç”»æ—¶é•¿è®¡ç®—

#### çˆ±å¿ƒæŒ‰é’®å‡ºç°æ—¶æœº

```typescript
// æ ¹æ®è¯—å¥é•¿åº¦åŠ¨æ€è®¡ç®—é˜…è¯»æ—¶é•¿
const textWithoutPunctuation = poemData.content.replace(/[ï¼Œã€‚ã€ï¼›ï¼ï¼Ÿ\s]/g, '');

// åŒºåˆ†ä¸­æ–‡å’Œéä¸­æ–‡
const chineseChars = textWithoutPunctuation.match(/[\u4e00-\u9fa5]/g) || [];
const nonChineseChars = textWithoutPunctuation.replace(/[\u4e00-\u9fa5]/g, '');

// è®¡ç®—æ—¶é•¿
const chineseDuration = (chineseChars.length / 3) * 1000;  // ä¸­æ–‡ï¼šæ¯ç§’ 3 å­—
const nonChineseDuration = (nonChineseChars.length / 8) * 1000;  // è‹±æ–‡ï¼šæ¯ç§’ 8 å­—
const calculatedDuration = chineseDuration + nonChineseDuration;

// ä¸Šé™ 15 ç§’
const displayDuration = Math.min(calculatedDuration, 15000);

setTimeout(() => {
  setShowLoveButton(true);
}, displayDuration);
```

#### å…¥åœºè¯—å¥æ·¡å…¥æ—¶é•¿

```typescript
// æ ¹æ®æ¯å¥å­—ç¬¦æ•°åˆ†é…æ—¶é—´
const charCounts = [5, 11, 11, 6, 6, 18, 6, 6];  // æ¯å¥çš„å­—ç¬¦æ•°

// æ€»æ—¶é•¿ 8 ç§’ï¼ŒæŒ‰å­—ç¬¦æ•°æ¯”ä¾‹åˆ†é…
const getLineStartTime = (index: number): number => {
  const totalChars = 65;  // æ€»å­—ç¬¦æ•°
  const totalDuration = 8;
  
  let startTime = 0;
  for (let i = 0; i < index; i++) {
    startTime += (charCounts[i] / totalChars) * totalDuration;
  }
  return startTime + index * 0.5;  // æ¯å¥å¢åŠ  0.5 ç§’ delay
};
```

---

### 3. ç¯å¢ƒå˜é‡ç®¡ç†

#### é…ç½®æ–‡ä»¶

```bash
# .env.localï¼ˆä¸æäº¤åˆ° Gitï¼‰
VITE_SUPABASE_URL=https://your-project.supabase.co
VITE_SUPABASE_ANON_KEY=your_anon_key
VITE_GEMINI_API_KEY=your_gemini_api_key
```

#### ä»£ç ä¸­è¯»å–

```typescript
// Vite é¡¹ç›®ä½¿ç”¨ import.meta.env
const apiKey = import.meta.env.VITE_GEMINI_API_KEY;
const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;
const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;

// å¯åŠ¨æ—¶æ£€æŸ¥
if (!apiKey) {
  throw new Error('ç¼ºå°‘ Gemini API Keyï¼è¯·æ£€æŸ¥ .env.local æ–‡ä»¶');
}
```

#### å„å¹³å°é€‚é…

| å¹³å° | ç¯å¢ƒå˜é‡æ–¹æ¡ˆ |
|------|-------------|
| **Web (Vite)** | `import.meta.env.VITE_*` |
| **React Native** | `react-native-config` æˆ– `@env` |
| **å¾®ä¿¡å°ç¨‹åº** | é…ç½®æ–‡ä»¶ + `wx.getEnvInfoSync()` |
| **Electron** | `process.env.*` |

---

### 4. é”™è¯¯å¤„ç†è§„èŒƒ

```typescript
try {
  // 1. AI è°ƒç”¨
  const poem = await generatePoem(keyword, mood);
  setPoemData(poem);
  
  // 2. å¼‚æ­¥ä¿å­˜
  savePoemToDatabase(poem.content, poem.poem_title, poem.author, keyword);
  
} catch (error) {
  // 3. è¯¦ç»†æ—¥å¿—
  console.error('âŒ AI è°ƒç”¨å¤±è´¥ï¼Œå®Œæ•´é”™è¯¯ä¿¡æ¯ï¼š', error);
  console.error('é”™è¯¯ç±»å‹:', error instanceof Error ? error.message : String(error));
  
  // 4. å®¹é”™æœºåˆ¶
  console.log('ğŸ”„ å°è¯•ä»æ•°æ®åº“è¯»å–å¤‡ç”¨è¯—å¥...');
  const fallbackPoem = await getRandomPoemFromDatabase();
  
  if (fallbackPoem) {
    setPoemData(fallbackPoem);
    console.log('âœ… ä½¿ç”¨æ•°æ®åº“å¤‡ç”¨è¯—å¥');
  } else {
    alert('è·å–è¯—å¥å¤±è´¥ï¼Œä¸”æ•°æ®åº“ä¸­æš‚æ— å¤‡ç”¨è¯—å¥ã€‚è¯·ç¨åé‡è¯•ã€‚');
  }
  
} finally {
  // 5. ç¡®ä¿é‡ç½®åŠ è½½çŠ¶æ€
  setIsLoading(false);
}
```

---

## ä¸ƒã€å¹³å°è¿ç§»æŒ‡å—

### 1. React Native è¿ç§»

#### åŠŸèƒ½å¯¹æ¯”è¡¨

| Web å®ç° | React Native æ›¿ä»£æ–¹æ¡ˆ | éš¾åº¦ |
|----------|---------------------|------|
| **Canvas ç²’å­** | `react-native-skia` æˆ– `react-native-canvas` | â­â­â­ |
| **ç‰©ç†å¼•æ“** | `react-native-reanimated` + è‡ªå®šä¹‰é€»è¾‘ | â­â­ |
| **èƒŒæ™¯æ¸å˜** | `<LinearGradient>` (expo-linear-gradient) | â­ |
| **Gemini API** | `fetch`ï¼ˆä¿æŒç›¸åŒï¼‰ | âœ… |
| **Supabase** | `@supabase/supabase-js`ï¼ˆä¿æŒç›¸åŒï¼‰ | âœ… |
| **Emoji æ¸²æŸ“** | Text ç»„ä»¶ï¼ˆåŸç”Ÿæ”¯æŒï¼‰ | âœ… |
| **æ¨¡ç³Šæ•ˆæœ** | `<BlurView>`ï¼ˆexpo-blurï¼‰ | â­ |

#### ç¤ºä¾‹ä»£ç 

```jsx
// App.tsx (React Native)
import { View, Text, TouchableOpacity } from 'react-native';
import { LinearGradient } from 'expo-linear-gradient';
import { Canvas } from '@shopify/react-native-skia';

export default function App() {
  return (
    <LinearGradient
      colors={['#0a0e27', '#1a1a3e']}
      style={{ flex: 1 }}
    >
      {/* Canvas ç²’å­ç³»ç»Ÿ */}
      <Canvas style={{ flex: 1 }}>
        {/* Skia ç»˜åˆ¶é€»è¾‘ */}
      </Canvas>
      
      {/* Emoji æŒ‰é’® */}
      {EMOJI_MOODS.map((item, index) => (
        <TouchableOpacity
          key={index}
          onPress={() => handleEmojiClick(item.keyword, item.mood)}
          style={[styles.emojiButton, emojiPositions[index]]}
        >
          <Text style={styles.emoji}>{item.emoji}</Text>
        </TouchableOpacity>
      ))}
    </LinearGradient>
  );
}
```

#### ä¼˜åŒ–å»ºè®®

1. **ç²’å­æ•°é‡**: 120 â†’ 50 ä¸ªï¼ˆæ€§èƒ½è€ƒè™‘ï¼‰
2. **ç‰©ç†å¼•æ“**: ç®€åŒ–ç¢°æ’æ£€æµ‹ï¼Œä½¿ç”¨ `Animated` API
3. **ç¯å¢ƒå˜é‡**: ä½¿ç”¨ `react-native-config`

---

### 2. å¾®ä¿¡å°ç¨‹åºè¿ç§»

#### åŠŸèƒ½å¯¹æ¯”è¡¨

| Web å®ç° | å°ç¨‹åºæ›¿ä»£æ–¹æ¡ˆ | éš¾åº¦ |
|----------|---------------|------|
| **Canvas ç²’å­** | `<canvas>` + Canvas 2D API | â­â­â­ |
| **ç‰©ç†å¼•æ“** | ç®€åŒ–ä¸º CSS åŠ¨ç”»ï¼ˆå–æ¶ˆç¢°æ’ï¼‰ | â­â­ |
| **èƒŒæ™¯æ¸å˜** | CSS `linear-gradient` | âœ… |
| **Gemini API** | `wx.request()` + é…ç½®ç™½åå• | â­ |
| **Supabase** | äº‘å¼€å‘æ•°æ®åº“ æˆ– REST API | â­â­ |
| **Emoji æ¸²æŸ“** | `<text>`ï¼ˆåŸç”Ÿæ”¯æŒï¼‰ | âœ… |
| **æ¨¡ç³Šæ•ˆæœ** | CSS `backdrop-filter`ï¼ˆéƒ¨åˆ†æ”¯æŒï¼‰ | â­ |

#### ç¤ºä¾‹ä»£ç 

```javascript
// pages/index/index.js
Page({
  data: {
    emojiMoods: [
      { emoji: 'ğŸ˜Š', mood: 'å¿«ä¹', keyword: 'happy' },
      // ...
    ],
    poemData: null,
    isLoading: false
  },

  handleEmojiClick(e) {
    const { keyword, mood } = e.currentTarget.dataset;
    
    this.setData({ isLoading: true });

    // è°ƒç”¨äº‘å‡½æ•°æˆ–ç›´æ¥è¯·æ±‚ Gemini API
    wx.cloud.callFunction({
      name: 'generatePoem',
      data: { keyword, mood }
    }).then(res => {
      this.setData({
        poemData: res.result,
        isLoading: false
      });
    }).catch(err => {
      console.error('AI è°ƒç”¨å¤±è´¥', err);
      // å®¹é”™ï¼šä»äº‘æ•°æ®åº“è¯»å–
      this.getRandomPoemFromDB();
    });
  }
});
```

#### æ³¨æ„äº‹é¡¹

1. **æœåŠ¡å™¨åŸŸåé…ç½®**: 
   - Gemini API: `https://generativelanguage.googleapis.com`
   - Supabase: `https://*.supabase.co`

2. **Canvas æ€§èƒ½ä¼˜åŒ–**:
   - ç²’å­æ•°å‡å°‘åˆ° 30 ä¸ª
   - ä½¿ç”¨ `canvas-2d` ç±»å‹ï¼ˆæ€§èƒ½æ›´å¥½ï¼‰

3. **ç¯å¢ƒå˜é‡ç®¡ç†**:
   ```javascript
   // config.js
   module.exports = {
     GEMINI_API_KEY: '***',
     SUPABASE_URL: '***'
   };
   ```

---

### 3. Electron æ¡Œé¢åº”ç”¨è¿ç§»

#### åŠŸèƒ½å¯¹æ¯”è¡¨

| Web å®ç° | Electron æ–¹æ¡ˆ | éš¾åº¦ |
|----------|--------------|------|
| **æ‰€æœ‰å‰ç«¯åŠŸèƒ½** | å®Œå…¨ä¿æŒï¼ˆä½¿ç”¨ Web æŠ€æœ¯æ ˆï¼‰ | âœ… |
| **API Key å®‰å…¨** | ä½¿ç”¨ IPC é€šä¿¡ + åç«¯ç®¡ç† | â­â­ |
| **æ€§èƒ½æå‡** | å¯å¢åŠ ç²’å­æ•°åˆ° 200 ä¸ª | âœ… |

#### API Key å®‰å…¨ç®¡ç†

```javascript
// main.js (ä¸»è¿›ç¨‹)
const { ipcMain } = require('electron');

ipcMain.handle('generate-poem', async (event, keyword, mood) => {
  // åœ¨ä¸»è¿›ç¨‹ä¸­è°ƒç”¨ APIï¼Œä¿æŠ¤ API Key
  const response = await fetch(API_URL, {
    headers: {
      'x-goog-api-key': process.env.GEMINI_API_KEY  // ä»ç¯å¢ƒå˜é‡è¯»å–
    },
    // ...
  });
  return response.json();
});
```

```typescript
// renderer.ts (æ¸²æŸ“è¿›ç¨‹)
const { ipcRenderer } = require('electron');

async function generatePoem(keyword: string, mood: string) {
  // é€šè¿‡ IPC è°ƒç”¨ä¸»è¿›ç¨‹
  const result = await ipcRenderer.invoke('generate-poem', keyword, mood);
  return result;
}
```

#### æ‰“åŒ…é…ç½®

```json
// package.json
{
  "name": "blind-poem",
  "version": "1.0.0",
  "main": "main.js",
  "scripts": {
    "start": "electron .",
    "build": "electron-builder"
  },
  "build": {
    "appId": "com.blindpoem.app",
    "mac": {
      "category": "public.app-category.entertainment"
    },
    "win": {
      "target": "nsis"
    }
  }
}
```

---

### 4. è¿ç§»å†³ç­–çŸ©é˜µ

| åŠŸèƒ½ | Web | RN | å°ç¨‹åº | Electron |
|------|-----|----|----|---------|
| **Canvas ç²’å­** | âœ… 120 ä¸ª | âš ï¸ 50 ä¸ª | âš ï¸ 30 ä¸ª | âœ… 200 ä¸ª |
| **ç‰©ç†å¼•æ“** | âœ… å®Œæ•´ | âš ï¸ ç®€åŒ– | âŒ å–æ¶ˆ | âœ… å®Œæ•´ |
| **AI è°ƒç”¨** | âœ… | âœ… | âš ï¸ éœ€äº‘å‡½æ•° | âœ… IPC å®‰å…¨ |
| **æ•°æ®åº“** | âœ… | âœ… | âš ï¸ äº‘å¼€å‘ | âœ… |
| **æ€§èƒ½** | ğŸŒŸğŸŒŸğŸŒŸ | ğŸŒŸğŸŒŸ | ğŸŒŸ | ğŸŒŸğŸŒŸğŸŒŸğŸŒŸ |
| **å¼€å‘æˆæœ¬** | ä½ | ä¸­ | ä¸­é«˜ | ä½ |

---

## å…«ã€æ ¸å¿ƒä¾èµ–

### package.json

```json
{
  "name": "blind-poem",
  "version": "1.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "react": "^18.3.1",
    "react-dom": "^18.3.1",
    "@supabase/supabase-js": "^2.39.0"
  },
  "devDependencies": {
    "typescript": "^5.2.2",
    "vite": "^5.0.8",
    "@vitejs/plugin-react": "^4.2.1",
    "tailwindcss": "^4.0.0",
    "postcss": "^8.4.33",
    "eslint": "^8.55.0"
  }
}
```

### æŠ€æœ¯æ ˆç‰ˆæœ¬

| æŠ€æœ¯ | å½“å‰ç‰ˆæœ¬ | è¯´æ˜ |
|------|---------|------|
| React | 18.3.1 | å‡½æ•°ç»„ä»¶ + Hooks |
| TypeScript | 5.2.2 | ç±»å‹å®‰å…¨ |
| Vite | 5.0.8 | å¿«é€Ÿå¼€å‘æœåŠ¡å™¨ |
| Tailwind CSS | 4.0.0 | å®ç”¨ä¼˜å…ˆæ ·å¼ |
| Supabase JS | 2.39.0 | æ•°æ®åº“å®¢æˆ·ç«¯ |

### æ— éœ€ SDK çš„æœåŠ¡

- **Gemini AI**: ç›´æ¥ä½¿ç”¨ REST APIï¼ˆ`fetch`ï¼‰
- **è‡ªå®šä¹‰å­—ä½“**: `/public/QianTuBiFengShouXieTi-2.ttf`

---

## ä¹ã€æ€»ç»“

### æ¶æ„ä¼˜åŠ¿

#### âœ… 1. æ— æœåŠ¡å™¨æ¶æ„
- å®Œå…¨ä¾èµ–äº‘æœåŠ¡ï¼ˆGemini AI + Supabaseï¼‰
- æ— éœ€è‡ªå»ºåç«¯ï¼Œé™ä½è¿ç»´æˆæœ¬
- å¿«é€Ÿéƒ¨ç½²åˆ° Vercel/Netlify

#### âœ… 2. ç±»å‹å®‰å…¨
- TypeScript å…¨è¦†ç›–
- æ˜ç¡®çš„æ¥å£å®šä¹‰ï¼ˆ`Poem`ã€`PoemResponse`ã€`EmojiMood`ï¼‰
- å‡å°‘è¿è¡Œæ—¶é”™è¯¯

#### âœ… 3. å®¹é”™æœºåˆ¶
- AI å¤±è´¥è‡ªåŠ¨é™çº§åˆ°æ•°æ®åº“
- æ•°æ®åº“å»é‡ï¼ˆå”¯ä¸€æ€§æ£€æŸ¥ï¼‰
- è¯¦ç»†çš„é”™è¯¯æ—¥å¿—ï¼ˆemoji å‰ç¼€ï¼‰

#### âœ… 4. æ€§èƒ½ä¼˜åŒ–
- `useMemo` ç¼“å­˜ç²’å­æ•°æ®
- Canvas `requestAnimationFrame` ä¼˜åŒ–æ¸²æŸ“
- CSS `will-change` + GPU åŠ é€Ÿ
- å¼‚æ­¥æ•°æ®åº“å†™å…¥ï¼ˆä¸é˜»å¡ UIï¼‰

#### âœ… 5. æ¨¡å—åŒ–è®¾è®¡
- æ ¸å¿ƒé€»è¾‘å°è£…åœ¨ `lib/` ç›®å½•
- æ˜“äºæµ‹è¯•å’Œå¤ç”¨
- æ¸…æ™°çš„æ–‡ä»¶ç»“æ„

---

### è¿ç§»æ ¸å¿ƒè¦ç‚¹

#### ä¿ç•™ä¸å˜çš„éƒ¨åˆ†

1. **AI è°ƒç”¨é€»è¾‘**
   - REST API è°ƒç”¨æ–¹å¼
   - Prompt æ¨¡æ¿è®¾è®¡
   - JSON è§£æé€»è¾‘

2. **æ•°æ®æŒä¹…åŒ–**
   - Supabase å®¢æˆ·ç«¯ï¼ˆè·¨å¹³å°å…¼å®¹ï¼‰
   - å”¯ä¸€æ€§æ£€æŸ¥é€»è¾‘
   - å®¹é”™æœºåˆ¶

3. **çŠ¶æ€ç®¡ç†**
   - React Hooks æ¨¡å¼ï¼ˆRN å¯ä¿æŒï¼‰
   - çŠ¶æ€è®¾è®¡æ€è·¯

4. **ä¸šåŠ¡é€»è¾‘**
   - Emoji å¿ƒæƒ…é…ç½®
   - èµèµåŠŸèƒ½æµç¨‹
   - åŠ¨ç”»æ—¶é•¿è®¡ç®—

---

#### éœ€è¦é€‚é…çš„éƒ¨åˆ†

| åŠŸèƒ½ | Web | RN | å°ç¨‹åº | Electron |
|------|-----|----|----|---------|
| **Canvas ç²’å­** | Canvas API | Skia/Canvas | Canvas 2D | Canvas API |
| **ç‰©ç†å¼•æ“** | RAF å¾ªç¯ | Reanimated | CSS åŠ¨ç”» | RAF å¾ªç¯ |
| **èƒŒæ™¯æ¸å˜** | CSS | LinearGradient | CSS | CSS |
| **ç¯å¢ƒå˜é‡** | `import.meta.env` | `react-native-config` | `config.js` | `process.env` |
| **API Key å®‰å…¨** | å®¢æˆ·ç«¯ | å®¢æˆ·ç«¯ | äº‘å‡½æ•° | IPC ä¸»è¿›ç¨‹ |

---

#### ä¼˜åŒ–å»ºè®®

| å¹³å° | ä¼˜åŒ–æ–¹å‘ |
|------|---------|
| **ç§»åŠ¨ç«¯** | ç²’å­æ•° 120 â†’ 50ï¼Œç®€åŒ–ç‰©ç†å¼•æ“ |
| **å°ç¨‹åº** | ç²’å­æ•° 120 â†’ 30ï¼Œå–æ¶ˆç‰©ç†å¼•æ“ï¼Œä½¿ç”¨äº‘å‡½æ•°ä¿æŠ¤ API Key |
| **æ¡Œé¢ç«¯** | ç²’å­æ•° 120 â†’ 200ï¼Œå¢å¼ºè§†è§‰æ•ˆæœ |

---

### å¿«é€Ÿè¿ç§»æ£€æŸ¥æ¸…å•

- [ ] å¤åˆ¶æ ¸å¿ƒé€»è¾‘ï¼ˆ`lib/` ç›®å½•ï¼‰
- [ ] é€‚é… Canvas æ¸²æŸ“æ–¹å¼
- [ ] è°ƒæ•´ç²’å­æ•°é‡ï¼ˆæ ¹æ®å¹³å°æ€§èƒ½ï¼‰
- [ ] é…ç½®ç¯å¢ƒå˜é‡ç®¡ç†
- [ ] æµ‹è¯• AI è°ƒç”¨ï¼ˆç½‘ç»œè¯·æ±‚ï¼‰
- [ ] æµ‹è¯•æ•°æ®åº“è¿æ¥ï¼ˆSupabase æˆ–äº‘å¼€å‘ï¼‰
- [ ] é€‚é…ç‰©ç†å¼•æ“ï¼ˆæˆ–ç®€åŒ–ï¼‰
- [ ] ä¼˜åŒ–åŠ¨ç”»æ€§èƒ½
- [ ] é…ç½®éƒ¨ç½²æµç¨‹

---

## é™„å½•

### A. æ–‡ä»¶æ¸…å•

```
BlindPoem/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ App.tsx                  # ä¸»åº”ç”¨ç»„ä»¶ï¼ˆ1253 è¡Œï¼‰
â”‚   â”œâ”€â”€ App.css                  # åº”ç”¨æ ·å¼å’ŒåŠ¨ç”»
â”‚   â”œâ”€â”€ index.css                # å…¨å±€æ ·å¼
â”‚   â”œâ”€â”€ main.tsx                 # React å…¥å£
â”‚   â””â”€â”€ lib/
â”‚       â”œâ”€â”€ geminiClient.ts      # Gemini AI è°ƒç”¨ï¼ˆ227 è¡Œï¼‰
â”‚       â”œâ”€â”€ poemService.ts       # æ•°æ®åº“æ“ä½œï¼ˆ94 è¡Œï¼‰
â”‚       â””â”€â”€ supabaseClient.ts    # Supabase é…ç½®ï¼ˆ25 è¡Œï¼‰
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ QianTuBiFengShouXieTi-2.ttf  # è‡ªå®šä¹‰å­—ä½“
â”‚   â””â”€â”€ qrcode.jpg               # èµèµäºŒç»´ç 
â”œâ”€â”€ .env.local                   # ç¯å¢ƒå˜é‡ï¼ˆä¸æäº¤ï¼‰
â”œâ”€â”€ package.json                 # ä¾èµ–é…ç½®
â”œâ”€â”€ vite.config.ts               # Vite é…ç½®
â”œâ”€â”€ tailwind.config.js           # Tailwind é…ç½®
â””â”€â”€ tsconfig.json                # TypeScript é…ç½®
```

### B. ç¯å¢ƒå˜é‡æ¨¡æ¿

```bash
# .env.local
VITE_SUPABASE_URL=https://your-project.supabase.co
VITE_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
VITE_GEMINI_API_KEY=AIzaSy...
```

### C. Supabase æ•°æ®åº“ SQL

```sql
-- åˆ›å»ºè¯—å¥è¡¨
CREATE TABLE poems (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  content TEXT NOT NULL UNIQUE,
  poem_title TEXT,
  author TEXT,
  mood TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_poems_mood ON poems(mood);
CREATE INDEX idx_poems_created_at ON poems(created_at DESC);

-- å¯ç”¨ RLS
ALTER TABLE poems ENABLE ROW LEVEL SECURITY;

-- å…è®¸æ‰€æœ‰äººè¯»å–
CREATE POLICY "Enable read access for all users" ON poems
  FOR SELECT USING (true);

-- å…è®¸æ‰€æœ‰äººæ’å…¥
CREATE POLICY "Enable insert for all users" ON poems
  FOR INSERT WITH CHECK (true);
```

### D. å‚è€ƒèµ„æº

- [Gemini API æ–‡æ¡£](https://ai.google.dev/gemini-api/docs)
- [Supabase æ–‡æ¡£](https://supabase.com/docs)
- [React Native Skia](https://shopify.github.io/react-native-skia/)
- [å¾®ä¿¡å°ç¨‹åº Canvas 2D](https://developers.weixin.qq.com/miniprogram/dev/component/canvas.html)
- [Electron æ–‡æ¡£](https://www.electronjs.org/docs)

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2025-10-11  
**ä½œè€…**: BlindPoem Team  
**é¡¹ç›®åœ°å€**: `/Users/dyl/GitHub/BlindPoem`

