---
globs: *.ts,*.tsx
---

# TypeScript å’Œ React å¼€å‘è§„èŒƒ

## TypeScript ç±»å‹å®šä¹‰

### æ ¸å¿ƒç±»å‹æ¥å£

#### è¯—å¥ç±»å‹
```typescript
// src/lib/supabaseClient.ts
export interface Poem {
  id?: string;
  content: string;          // è¯—å¥å†…å®¹ï¼ˆå¿…å¡«ï¼‰
  poem_title?: string;      // è¯—åï¼ˆå¯é€‰ï¼Œæ•°æ®åº“ä¸­å¯èƒ½ä¸ºç©ºï¼‰
  author?: string;          // ä½œè€…ï¼ˆå¯é€‰ï¼Œæ•°æ®åº“ä¸­å¯èƒ½ä¸ºç©ºï¼‰
  mood?: string;            // å¿ƒæƒ…å…³é”®è¯ï¼ˆå¦‚ï¼šhappy, sadï¼‰
  created_at?: string;      // åˆ›å»ºæ—¶é—´
}
```

#### Gemini API è¿”å›ç±»å‹
```typescript
// src/lib/geminiClient.ts
export interface PoemResponse {
  content: string;      // è¯—å¥å†…å®¹ï¼ˆâ‰¤30å­—ï¼‰
  poem_title: string;   // è¯—å
  author: string;       // ä½œè€…
}
```

#### Emoji å¿ƒæƒ…ç±»å‹
```typescript
// src/App.tsx
interface EmojiMood {
  emoji: string;    // Emoji å­—ç¬¦ï¼ˆå¦‚ï¼šğŸ˜Šï¼‰
  mood: string;     // ä¸­æ–‡å¿ƒæƒ…åï¼ˆå¦‚ï¼šå¿«ä¹ï¼‰
  keyword: string;  // è‹±æ–‡å…³é”®è¯ï¼ˆå¦‚ï¼šhappyï¼‰
}
```

### ç±»å‹è§„èŒƒ
- âœ… **å¿…é¡»å®šä¹‰æ¥å£**: æ‰€æœ‰ API è¿”å›å€¼ã€æ•°æ®åº“æ¨¡å‹éƒ½è¦æœ‰æ¥å£
- âœ… **ä½¿ç”¨æ˜ç¡®ç±»å‹**: é¿å…ä½¿ç”¨ `any`ï¼Œç”¨ `unknown` æˆ–å…·ä½“ç±»å‹
- âœ… **å¯é€‰å±æ€§**: ä½¿ç”¨ `?` æ ‡è®°å¯èƒ½ä¸ºç©ºçš„å­—æ®µ
- âŒ **é¿å…ç±»å‹æ–­è¨€**: é™¤éç¡®å®å¿…è¦ï¼Œä¸è¦ä½¿ç”¨ `as`

---

## React ç»„ä»¶è§„èŒƒ

### å‡½æ•°ç»„ä»¶ç»“æ„
```typescript
import { useState, useEffect } from 'react';

function App() {
  // 1. çŠ¶æ€å®šä¹‰ï¼ˆä½¿ç”¨æ˜ç¡®ç±»å‹ï¼‰
  const [isLoading, setIsLoading] = useState<boolean>(false);
  const [poemData, setPoemData] = useState<{
    content: string;
    poem_title: string;
    author: string;
  } | null>(null);

  // 2. Effect hooks
  useEffect(() => {
    // å‰¯ä½œç”¨é€»è¾‘
  }, [ä¾èµ–é¡¹]);

  // 3. äº‹ä»¶å¤„ç†å‡½æ•°
  const handleEmojiClick = async (keyword: string, mood: string) => {
    // å¤„ç†é€»è¾‘
  };

  // 4. æ¸²æŸ“
  return (
    <div>
      {/* JSX */}
    </div>
  );
}

export default App;
```

### ç»„ä»¶å‘½åè§„èŒƒ
- **ç»„ä»¶æ–‡ä»¶**: PascalCaseï¼Œå¦‚ `App.tsx`
- **å·¥å…·å‡½æ•°**: camelCaseï¼Œå¦‚ `geminiClient.ts`
- **ç±»å‹æ–‡ä»¶**: PascalCaseï¼Œå¦‚ `PoemResponse`

---

## State ç®¡ç†è§„èŒƒ

### çŠ¶æ€è®¾è®¡åŸåˆ™
```typescript
// âœ… æ¨èï¼šçŠ¶æ€æœ€å°åŒ–ï¼Œæ˜ç¡®ç±»å‹
const [poemData, setPoemData] = useState<PoemResponse | null>(null);
const [isLoading, setIsLoading] = useState<boolean>(false);

// âŒ é¿å…ï¼šçŠ¶æ€å†—ä½™
const [poemContent, setPoemContent] = useState<string>('');
const [poemTitle, setPoemTitle] = useState<string>('');
const [poemAuthor, setPoemAuthor] = useState<string>('');
// åº”è¯¥åˆå¹¶æˆä¸€ä¸ªå¯¹è±¡
```

### å¼‚æ­¥çŠ¶æ€æ›´æ–°
```typescript
const handleEmojiClick = async (keyword: string, mood: string) => {
  setIsLoading(true);
  setPoemData(null); // æ¸…ç©ºä¹‹å‰çš„æ•°æ®
  
  try {
    const poem = await generatePoem(keyword, mood);
    setPoemData(poem);
    
    // å¼‚æ­¥æ“ä½œä¸é˜»å¡ UI
    savePoemToDatabase(poem.content, poem.poem_title, poem.author, keyword);
  } catch (error) {
    console.error('âŒ é”™è¯¯ï¼š', error);
    // å®¹é”™é€»è¾‘
  } finally {
    setIsLoading(false); // ç¡®ä¿åŠ è½½çŠ¶æ€é‡ç½®
  }
};
```

---

## Effect Hooks ä½¿ç”¨è§„èŒƒ

### å®šæ—¶å™¨æ¸…ç†
```typescript
// âœ… æ¨èï¼šæ­£ç¡®æ¸…ç†å®šæ—¶å™¨
useEffect(() => {
  if (poemData) {
    const timer = setTimeout(() => {
      setShowLoveButton(true);
    }, 10000);

    // æ¸…ç†å‡½æ•°
    return () => clearTimeout(timer);
  }
}, [poemData]);
```

### ä¾èµ–é¡¹è§„èŒƒ
```typescript
// âœ… æ¨èï¼šæ˜ç¡®åˆ—å‡ºæ‰€æœ‰ä¾èµ–
useEffect(() => {
  fetchData(userId, filter);
}, [userId, filter]);

// âŒ é¿å…ï¼šç©ºä¾èµ–æ•°ç»„ä½†ä½¿ç”¨äº†å¤–éƒ¨å˜é‡
useEffect(() => {
  fetchData(userId); // userId åº”è¯¥åœ¨ä¾èµ–æ•°ç»„ä¸­
}, []);

// âœ… å¦‚æœç¡®å®åªæƒ³è¿è¡Œä¸€æ¬¡ï¼Œç¡®ä¿ä¸ä¾èµ–å¤–éƒ¨çŠ¶æ€
useEffect(() => {
  console.log('ç»„ä»¶æŒ‚è½½');
}, []);
```

---

## é”™è¯¯å¤„ç†è§„èŒƒ

### API è°ƒç”¨é”™è¯¯å¤„ç†
```typescript
// âœ… æ¨èï¼šå®Œæ•´çš„é”™è¯¯å¤„ç†
try {
  const poem = await generatePoem(keyword, mood);
  setPoemData(poem);
} catch (error) {
  console.error('âŒ AI è°ƒç”¨å¤±è´¥ï¼š', error);
  
  // å®¹é”™æœºåˆ¶
  const fallbackPoem = await getRandomPoemFromDatabase();
  
  if (fallbackPoem) {
    setPoemData(fallbackPoem);
    console.log('âœ… ä½¿ç”¨æ•°æ®åº“å¤‡ç”¨è¯—å¥');
  } else {
    // æœ€ç»ˆå¤±è´¥æç¤º
    alert('è·å–è¯—å¥å¤±è´¥ï¼Œä¸”æ•°æ®åº“ä¸­æš‚æ— å¤‡ç”¨è¯—å¥ã€‚');
  }
} finally {
  setIsLoading(false);
}
```

### ç¯å¢ƒå˜é‡æ£€æŸ¥
```typescript
// âœ… æ¨èï¼šå¯åŠ¨æ—¶æ£€æŸ¥ç¯å¢ƒå˜é‡
const apiKey = import.meta.env.VITE_GEMINI_API_KEY;

if (!apiKey) {
  throw new Error('ç¼ºå°‘ Gemini API Keyï¼è¯·æ£€æŸ¥ .env.local æ–‡ä»¶');
}
```

---

## æ€§èƒ½ä¼˜åŒ–

### é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“
```typescript
// âœ… æ¨èï¼šä½¿ç”¨ React.memo åŒ…è£¹çº¯ç»„ä»¶
import { memo } from 'react';

const EmojiButton = memo(({ emoji, onClick }: Props) => {
  return <button onClick={onClick}>{emoji}</button>;
});

// âœ… æ¨èï¼šä½¿ç”¨ useCallback ç¼“å­˜å‡½æ•°
const handleClick = useCallback((keyword: string) => {
  console.log(keyword);
}, []);
```

### å¼‚æ­¥æ“ä½œä¸é˜»å¡ UI
```typescript
// âœ… æ¨èï¼šæ•°æ®åº“å†™å…¥å¼‚æ­¥æ‰§è¡Œ
setPoemData(poem);

// ä¸ä½¿ç”¨ awaitï¼Œä¸é˜»å¡ UI
savePoemToDatabase(poem.content, poem.poem_title, poem.author, keyword);
```

---

## ä»£ç é£æ ¼

### å‘½åè§„èŒƒ
```typescript
// ç»„ä»¶ï¼šPascalCase
function PoemDisplay() {}

// å‡½æ•°ï¼šcamelCase
function generatePoem() {}

// å¸¸é‡ï¼šUPPER_SNAKE_CASE
const MAX_POEM_LENGTH = 30;

// ç±»å‹ï¼šPascalCase
interface PoemResponse {}
```

### æ³¨é‡Šè§„èŒƒ
```typescript
/**
 * æ ¹æ®å¿ƒæƒ…å…³é”®è¯ç”Ÿæˆè¯—å¥
 * @param keyword å¿ƒæƒ…å…³é”®è¯ï¼ˆå¦‚ï¼šhappy, sadï¼‰
 * @param moodName å¿ƒæƒ…åç§°ï¼ˆå¦‚ï¼šå¿«ä¹ã€æ‚²ä¼¤ï¼‰
 * @returns è¯—å¥æ•°æ®ï¼ˆcontent, poem_title, authorï¼‰
 */
export async function generatePoem(
  keyword: string,
  moodName: string
): Promise<PoemResponse> {
  // å®ç°
}
```

### Import é¡ºåº
```typescript
// 1. React å’Œç¬¬ä¸‰æ–¹åº“
import { useState, useEffect } from 'react';
import { GoogleGenerativeAI } from '@google/generative-ai';

// 2. æœ¬åœ°æ¨¡å—
import { supabase, Poem } from './lib/supabaseClient';
import { generatePoem } from './lib/geminiClient';

// 3. æ ·å¼æ–‡ä»¶
import './App.css';
```

---

## æœ€ä½³å®è·µ

### âœ… æ¨èåšæ³•
- ä½¿ç”¨ TypeScript ä¸¥æ ¼æ¨¡å¼ï¼ˆ`"strict": true`ï¼‰
- æ‰€æœ‰å¼‚æ­¥å‡½æ•°å¿…é¡»æœ‰é”™è¯¯å¤„ç†
- ç»„ä»¶ä¿æŒç®€æ´ï¼Œå¤æ‚é€»è¾‘æå–åˆ° `lib/` ç›®å½•
- ä½¿ç”¨ `console.log` æ—¶æ·»åŠ  emoji å‰ç¼€ï¼ˆâœ… âŒ âš ï¸ï¼‰
- ç¯å¢ƒå˜é‡ä½¿ç”¨ `import.meta.env.VITE_*` è®¿é—®

### âŒ é¿å…åšæ³•
- ä¸è¦ä½¿ç”¨ `any` ç±»å‹
- ä¸è¦åœ¨ç»„ä»¶ä¸­ç›´æ¥å†™å¤æ‚çš„ä¸šåŠ¡é€»è¾‘
- ä¸è¦å¿½ç•¥ ESLint è­¦å‘Š
- ä¸è¦åœ¨ useEffect ä¸­å¿˜è®°æ¸…ç†å‰¯ä½œç”¨
- ä¸è¦ç¡¬ç¼–ç  API Key æˆ–æ•æ„Ÿä¿¡æ¯

### è°ƒè¯•æŠ€å·§
```typescript
// ä½¿ç”¨å¸¦ç±»å‹çš„ console.log
console.log('âœ… è¯—å¥æ•°æ®ï¼š', poem satisfies PoemResponse);

// ä½¿ç”¨æ–­ç‚¹è°ƒè¯•
debugger;

// ç±»å‹æ£€æŸ¥
const poem: PoemResponse = await generatePoem(keyword, mood);
```
